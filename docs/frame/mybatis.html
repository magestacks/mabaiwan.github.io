<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>Mybatis 核心架构设计分享 | 小马哥の代码实战课</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/assets/xiaomage-logo.JPG">
    <script type="text/javascript" src="/assets/js/push.js"></script>
    <script charset="utf-8" src="https://my.openwrite.cn/js/readmore.js"></script>
    <meta name="description" content="一个不是在造轮子，就是在造轮子路上的程序员，追求优雅编码。写过博客，参与过开源项目，热衷于基础架构。">
    <meta name="referrer" content="never">
    <meta name="keywords" content="antdocs,antdeisgn,vuepress,vuepress-theme,theme,ant,docs,antd,antdocs of vuepress,主题,vuepress主题,antd设计,blog,vuepress-blog">
    <link rel="preload" href="/assets/css/0.styles.b37e4d9f.css" as="style"><link rel="preload" href="/assets/js/app.7eb18571.js" as="script"><link rel="preload" href="/assets/js/2.670b9761.js" as="script"><link rel="preload" href="/assets/js/22.20904317.js" as="script"><link rel="prefetch" href="/assets/js/10.a5a9903d.js"><link rel="prefetch" href="/assets/js/11.5762fdcb.js"><link rel="prefetch" href="/assets/js/12.3d30dbb9.js"><link rel="prefetch" href="/assets/js/13.167f50d8.js"><link rel="prefetch" href="/assets/js/14.73090bec.js"><link rel="prefetch" href="/assets/js/15.c99b25a1.js"><link rel="prefetch" href="/assets/js/16.8e1e672b.js"><link rel="prefetch" href="/assets/js/17.3f44f769.js"><link rel="prefetch" href="/assets/js/18.eb50631d.js"><link rel="prefetch" href="/assets/js/19.b81fb5c1.js"><link rel="prefetch" href="/assets/js/20.9e106839.js"><link rel="prefetch" href="/assets/js/21.899094ac.js"><link rel="prefetch" href="/assets/js/23.54f25aab.js"><link rel="prefetch" href="/assets/js/24.9980ebcd.js"><link rel="prefetch" href="/assets/js/25.3068a180.js"><link rel="prefetch" href="/assets/js/26.b9dbabce.js"><link rel="prefetch" href="/assets/js/27.fe33b48c.js"><link rel="prefetch" href="/assets/js/28.53c3669d.js"><link rel="prefetch" href="/assets/js/29.aea97b6c.js"><link rel="prefetch" href="/assets/js/3.f8b3c6d2.js"><link rel="prefetch" href="/assets/js/30.601a6826.js"><link rel="prefetch" href="/assets/js/31.c8fd8006.js"><link rel="prefetch" href="/assets/js/32.679c3c46.js"><link rel="prefetch" href="/assets/js/33.0632bf2f.js"><link rel="prefetch" href="/assets/js/34.87ee7489.js"><link rel="prefetch" href="/assets/js/35.ae124e8e.js"><link rel="prefetch" href="/assets/js/36.0b5e4932.js"><link rel="prefetch" href="/assets/js/37.241fb3e7.js"><link rel="prefetch" href="/assets/js/38.20592ee2.js"><link rel="prefetch" href="/assets/js/39.bec8855a.js"><link rel="prefetch" href="/assets/js/4.fa07bc29.js"><link rel="prefetch" href="/assets/js/40.19c4f912.js"><link rel="prefetch" href="/assets/js/41.efec0c07.js"><link rel="prefetch" href="/assets/js/5.ac01bbe0.js"><link rel="prefetch" href="/assets/js/6.e506f546.js"><link rel="prefetch" href="/assets/js/7.929e0a1e.js"><link rel="prefetch" href="/assets/js/8.5a319efc.js"><link rel="prefetch" href="/assets/js/9.0dc60c38.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b37e4d9f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="ant-row"><div class="nav-button"><i aria-label="icon: bars" class="anticon anticon-bars"><svg viewBox="0 0 1024 1024" focusable="false" data-icon="bars" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0z"></path></svg></i> <span></span></div> <div class="ant-col ant-col-xs-24 ant-col-sm-24 ant-col-md-6 ant-col-lg-6 ant-col-xl-5 ant-col-xxl-4"><a href="/" class="router-link-active home-link"><img src="/assets/xiaomage-logo.JPG" alt="小马哥の代码实战课" class="logo"> <span class="site-name">小马哥の代码实战课</span></a> <div class="search-box mobile-search"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div> <div class="ant-col ant-col-xs-0 ant-col-sm-0 ant-col-md-18 ant-col-lg-18 ant-col-xl-19 ant-col-xxl-20"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><ul role="menu" id="nav" class="ant-menu ant-menu-horizontal ant-menu-root ant-menu-light"><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/" class="router-link-active">
          首页
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="https://sourl.cn/ruwYW4" target="_blank">
          🥇代码实战课
          <i aria-label="icon: link" class="anticon anticon-link"><svg viewBox="64 64 896 896" focusable="false" data-icon="link" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M574 665.4a8.03 8.03 0 0 0-11.3 0L446.5 781.6c-53.8 53.8-144.6 59.5-204 0-59.5-59.5-53.8-150.2 0-204l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3l-39.8-39.8a8.03 8.03 0 0 0-11.3 0L191.4 526.5c-84.6 84.6-84.6 221.5 0 306s221.5 84.6 306 0l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3L574 665.4zm258.6-474c-84.6-84.6-221.5-84.6-306 0L410.3 307.6a8.03 8.03 0 0 0 0 11.3l39.7 39.7c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c53.8-53.8 144.6-59.5 204 0 59.5 59.5 53.8 150.2 0 204L665.3 562.6a8.03 8.03 0 0 0 0 11.3l39.8 39.8c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c84.5-84.6 84.5-221.5 0-306.1zM610.1 372.3a8.03 8.03 0 0 0-11.3 0L372.3 598.7a8.03 8.03 0 0 0 0 11.3l39.6 39.6c3.1 3.1 8.2 3.1 11.3 0l226.4-226.4c3.1-3.1 3.1-8.2 0-11.3l-39.5-39.6z"></path></svg></i></a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/docs/thread/thread-pool-thread-destroy.html">
          技术笔记
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="visibility:hidden;position:absolute;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li></ul> <ul class="extra-group"><li><a href="https://github.com/mageeric" target="_blank" rel="noopener noreferrer" class="repo-link"><i aria-label="icon: github" class="anticon anticon-github"><svg viewBox="64 64 896 896" focusable="false" data-icon="github" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9a127.5 127.5 0 0 1 38.1 91v112.5c.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"></path></svg></i></a></li> <!----></ul></nav></div></div> <!----></header> <aside class="sidebar"><div><div class="promo"><div id="promo_3"><div class="promo_title">赞助商</div> <button type="button" class="ant-btn ant-btn-primary ant-btn-background-ghost"><span>成为赞助商</span></button></div></div> <div role="separator" id="reset-margin" class="ant-divider ant-divider-horizontal ant-divider-dashed"></div></div>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>并发编程</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>设计模式</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>场景问题</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>分布式篇</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>框架学习</span> <span class="arrow down"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/frame/mybatis.html" aria-current="page" title="Mybatis 核心架构设计分享" class="active sidebar-link">Mybatis 核心架构设计分享</a></li><li><a href="/docs/frame/mybatis-dynamic-proxy.html" title="心态崩了呀！Mybatis 动态代理这么玩？！" class="sidebar-link">心态崩了呀！Mybatis 动态代理这么玩？！</a></li><li><a href="/docs/frame/open-feign.html" title="花一个周末，掌握 OpenFeign 核心原理" class="sidebar-link">花一个周末，掌握 OpenFeign 核心原理</a></li><li><a href="/docs/frame/ribbon.html" title="花一个周末，掌握 SpringCloud Ribbon 核心原理" class="sidebar-link">花一个周末，掌握 SpringCloud Ribbon 核心原理</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>读书笔记</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-antdocs-content content__default"><h1 id="mybatis-核心架构设计分享">Mybatis 核心架构设计分享 <a href="#mybatis-核心架构设计分享" class="header-anchor">#</a></h1> <blockquote><p>本次分享内容依据 Mybatis-3-3.4.x 源码</p></blockquote> <h2 id="带着问题思考本次分享">带着问题思考本次分享 <a href="#带着问题思考本次分享" class="header-anchor">#</a></h2> <ol><li>Mybatis 与 JDBC 的关系</li> <li>.xml 文件定义 SQL 语句如何解析</li> <li>Mybatis 中 Mapper 接口的存储与实现</li> <li>Mybatis SQL 的执行过程</li> <li>Mybatis 中分页如何实现</li></ol> <h2 id="持久层的那些事">持久层的那些事 <a href="#持久层的那些事" class="header-anchor">#</a></h2> <h3 id="jdbc">JDBC <a href="#jdbc" class="header-anchor">#</a></h3> <h4 id="什么是-jdbc">什么是 JDBC <a href="#什么是-jdbc" class="header-anchor">#</a></h4> <p>JDBC（JavaDataBase Connectivity）就是 Java 数据库连接, 说的直白点就是 <strong>使用 Java 语言操作数据库</strong></p> <p>本来我们是通过控制台或客户端操作的数据库, JDBC 是用 Java 语言来发送 SQL 语句</p> <h4 id="jdbc-原理">JDBC 原理 <a href="#jdbc-原理" class="header-anchor">#</a></h4> <p>最初 SUN 公司希望提供一套 <strong>能够适用所有数据库的 API</strong>, 但是在实际操作中却发现这是项基本不可能完成的任务</p> <p>因为各个厂商所提供的 <strong>数据库差异实在太大</strong>, 所以 SUN 公司与数据库厂商讨论出的就是：由 <strong>SUN 公司提供出一套访问数据库的规范 API</strong>, 并提供相对应的连接数据库协议标准, 然后各厂商根据规范提供一套访问自家数据库的 API 接口</p> <p>最终：SUN 公司提供的规范 API 称之为 <strong>JDBC</strong>, 各厂商提供的自家数据库 API 接口称之为 <strong>驱动</strong></p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/image-20200818124614542.png" alt="JDBC 架构图"></p> <h3 id="mybatis">Mybatis <a href="#mybatis" class="header-anchor">#</a></h3> <h4 id="什么是-mybatis">什么是 Mybatis <a href="#什么是-mybatis" class="header-anchor">#</a></h4> <p>Mybatis 是一款优秀的 ORM（持久层）框架，使用 Java 语言 编写</p> <p>前身是 apache 的一个开源项目 iBatis，2010 年迁移到 google code 并正式改名为 Mybatis</p> <p>ORM 持久层 指的是 : <strong>将业务数据存储到磁盘，也具备长期存储能力，只要磁盘不损坏，如果在断电情况下，重启系统仍然可以读取数据</strong></p> <h4 id="mybatis-与-jdbc-的关系">Mybatis 与 JDBC 的关系 <a href="#mybatis-与-jdbc-的关系" class="header-anchor">#</a></h4> <p>在没有持久层框架之前, 想要代码中操作数据库都必须通过 JDBC 来操作, 接下来一个例子来说明两者之间的关系</p> <p><strong>JDBC 操作数据库</strong></p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/carbon_jdbc.png" alt="JDBC"></p> <p>相信大家都在实际项目中使用过 Mybatis, 可以联想一下, 平常我们工作中, 是否做过以下事情：</p> <ul><li>是否装载过数据库驱动？</li> <li>是否从驱动中获取数据库连接？</li> <li>是否创建过执行 SQL 的 Statement？</li> <li>是否自行将数据库返回结果转换成 Java 对象？</li> <li>是否关闭过 finally 块中的三个对象？</li></ul> <p>看到上面的灵魂拷问, 就可以对本次分享的第一个问题作出解答:</p> <p><strong>Mybatis 针对 JDBC 中重复操作做了封装, 同时扩展并优化部分功能</strong></p> <h2 id="mybatis-关键词说明">Mybatis 关键词说明 <a href="#mybatis-关键词说明" class="header-anchor">#</a></h2> <blockquote><p>📖 如果在阅读文章前没有接触过 Mybatis 源码相关的内容, 建议将下述名词多看几遍再向下阅读</p></blockquote> <h3 id="sqlsession">SqlSession <a href="#sqlsession" class="header-anchor">#</a></h3> <p>负责执行 <strong>select、insert、update、delete</strong> 等命令, 同时负责获取映射器和管理事务; 其底层封装了与 JDBC 的交互, 可以说是 mybatis 最核心的接口之一</p> <h3 id="sqlsessionfactory">SqlSessionFactory <a href="#sqlsessionfactory" class="header-anchor">#</a></h3> <p>负责创建 <strong>SqlSession</strong> 的工厂, 一旦被创建就应该在应用运行期间一直存在, <strong>不需要额外再进行创建</strong></p> <h3 id="sqlsessionfactorybuilder">SqlSessionFactoryBuilder <a href="#sqlsessionfactorybuilder" class="header-anchor">#</a></h3> <p>主要是负责创建 <strong>SqlSessionFactory</strong> 的构造器类, 其中使用到了构建者设计模式; 仅负责创建 <strong>SqlSessionFactory</strong></p> <h3 id="configuration">Configuration <a href="#configuration" class="header-anchor">#</a></h3> <p>Mybatis 最重要的配置类, 没有之一, 存储了大量的对象配置, 可以看源码感受一下</p> <h3 id="mappedstatement">MappedStatement <a href="#mappedstatement" class="header-anchor">#</a></h3> <p>MappedStatement 是保存 SQL 语句的数据结构, 其中的类属性都是由解析 .xml 文件中的 SQL 标签转化而成</p> <h3 id="executor">Executor <a href="#executor" class="header-anchor">#</a></h3> <p>SqlSession 对象对应一个 Executor, Executor 对象作用于 <strong>增删改查方法</strong> 以及 <strong>事务、缓存</strong> 等操作</p> <h3 id="parameterhandler">ParameterHandler <a href="#parameterhandler" class="header-anchor">#</a></h3> <p>Mybatis 中的 <strong>参数处理器</strong>, 类关系比较简单</p> <h3 id="statementhandler">StatementHandler <a href="#statementhandler" class="header-anchor">#</a></h3> <p>StatementHandler 是 Mybatis 负责 <strong>创建 Statement 的处理器</strong>, 根据不同的业务创建不同功能的 Statement</p> <h3 id="resultsethandler">ResultSetHandler <a href="#resultsethandler" class="header-anchor">#</a></h3> <p>ResultSetHandler 是 Mybatis 负责将 JDBC 返回数据进行解析, 并包装为 Java 中对应数据结构的处理器</p> <h3 id="interceptor">Interceptor <a href="#interceptor" class="header-anchor">#</a></h3> <p>Interceptor 为 Mybatis 中定义公共拦截器的接口, 其中定义了相关实现方法</p> <h2 id="mybatis-架构设计">Mybatis 架构设计 <a href="#mybatis-架构设计" class="header-anchor">#</a></h2> <h3 id="架构图">架构图 <a href="#架构图" class="header-anchor">#</a></h3> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/Mybatis%E6%9E%B6%E6%9E%84%E5%88%86%E6%9E%90-Mybatis%E6%9E%B6%E6%9E%84%E5%9B%BE_2.png" alt="Mybatis 分层架构图"></p> <h3 id="基础支持层">基础支持层 <a href="#基础支持层" class="header-anchor">#</a></h3> <h4 id="反射模块">反射模块 <a href="#反射模块" class="header-anchor">#</a></h4> <p>反射在 Java 中的应用可以说是相当广泛了, 同时也是一把双刃剑。 Mybatis 框架本身 <strong>封装出了反射模块</strong>, 提供了比原生反射更 <strong>简洁易用的 API 接口</strong>, 以及对 <strong>类的元数据增加缓存, 提高反射的性能</strong></p> <h4 id="类型转换">类型转换 <a href="#类型转换" class="header-anchor">#</a></h4> <p>类型转换模块最重要的功能就是在为 SQL 语句绑定实参时, 将 <strong>Java 类型转为 JDBC 类型</strong>, 在映射结果集时再由 <strong>JDBC 类型转为 Java 类型</strong></p> <p>另外一个功能就是提供别名机制, 简化了配置文件的定义</p> <h4 id="日志模块">日志模块 <a href="#日志模块" class="header-anchor">#</a></h4> <p>日志对于系统的作用不言而喻, 尤其是测试、生产环境上查看信息及排查错误等都非常重要。主流的日志框架包括 Log4j、Log4j2、S l f4j 等, Mybatis 的日志模块作用就是 <strong>集成这些日志框架</strong></p> <h4 id="资源加载">资源加载 <a href="#资源加载" class="header-anchor">#</a></h4> <p>Mybatis 对类加载器进行了封装, 用来确定类加载器的使用顺序, 用来记载类文件以及其它资源文件, 感兴趣可以参考 <strong>ClassLoaderWrapper</strong></p> <h4 id="解析器模块">解析器模块 <a href="#解析器模块" class="header-anchor">#</a></h4> <p>解析器模块主要提供了两个功能, 一个是封装了 XPath 类, 在 Mybatis 初始化时解析 Mybatis-config.xml 配置文件以及映射配置文件提供功能, 另一点就是处理动态 SQL 语句的占位符提供帮助</p> <h4 id="">... <a href="#" class="header-anchor">#</a></h4> <h3 id="核心处理层">核心处理层 <a href="#核心处理层" class="header-anchor">#</a></h3> <h4 id="配置解析">配置解析 <a href="#配置解析" class="header-anchor">#</a></h4> <p>在 Mybatis 初始化时, 会加载 Mybatis-config.xml 文件中的配置信息, 解析后的配置信息会 <strong>转换成 Java 对象添加到 Configuration 对象</strong></p> <blockquote><p>📖 比如说在 .xml 中定义的 resultMap 标签, 会被解析为 ResultMap 对象</p></blockquote> <h4 id="sql-解析">SQL 解析 <a href="#sql-解析" class="header-anchor">#</a></h4> <p>大家如果手动拼写过复杂 SQL 语句, 就会明白会有多痛苦。Mybatis 提供出了动态 SQL, 加入了许多判断循环型标签, 比如 : if、where、foreach、set 等, 帮助开发者节约了大量的 SQL 拼写时间</p> <p>SQL 解析模块的作用就是将 Mybatis 提供的动态 SQL 标签解析为带占位符的 SQL 语句, 并在后期将实参对占位符进行替换</p> <h4 id="sql-执行">SQL 执行 <a href="#sql-执行" class="header-anchor">#</a></h4> <p>SQL 的执行过程涉及几个比较重要的对象, <strong>Executor、StatementHandler、ParameterHandler、ResultSetHandler</strong></p> <p>Executor 负责维护 <strong>一级、二级缓存以及事务提交回滚操作</strong>, 举个查询的例子, 查询请求会由 Executor 交给 StatementHandler 完成</p> <p>StatementHandler 通过 ParameterHandler 完成 <strong>SQL 语句的实参绑定</strong>, 通过 java.sql.Statement 执行 SQL 语句并拿到对应的 <strong>结果集映射</strong></p> <p>最后交由 ResultSetHandler 对结果集进行解析, 将 JDBC 类型转换为程序自定义的对象</p> <h4 id="插件">插件 <a href="#插件" class="header-anchor">#</a></h4> <p>插件模块是 Mybatis 提供的一层扩展, 可以针对 SQL 执行的四大对象进行 <strong>拦截并执行自定义插件</strong></p> <p>插件编写需要很熟悉 Mybatis 运行机制, 这样才能控制编写的插件安全、高效</p> <h3 id="接口层">接口层 <a href="#接口层" class="header-anchor">#</a></h3> <p>接口层只是 Mybatis <strong>提供给调用端的一个接口 SqlSession</strong>, 调用端在进行调用接口中方法时, 会调用核心处理层相对应的模块来完成数据库操作</p> <h2 id="问题答疑">问题答疑 <a href="#问题答疑" class="header-anchor">#</a></h2> <h3 id="xml-文件定义-sql-语句如何解析">.xml 文件定义 Sql 语句如何解析 <a href="#xml-文件定义-sql-语句如何解析" class="header-anchor">#</a></h3> <p>Mybatis 在创建 SqlSessionFactory 时, XMLConfigBuilder 会解析 Mybatis-config.xml 配置文件</p> <h4 id="mybatis-相关解析器">Mybatis 相关解析器 <a href="#mybatis-相关解析器" class="header-anchor">#</a></h4> <p>Mybatis 解析器模块中定义了相关解析器的抽象类 BaseBuilder, 不同的子类负责实现解析不同的功能, 使用了 Builder 设计模式</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/image-20200902131259623.png" alt="BaseBuilder"></p> <p>XMLConfigBuilder 负责解析 mybatis-config.xml 配置文件</p> <p>XMLMapperBuilder 负责解析业务产生的 xxxMapper.xml</p> <p>...</p> <h4 id="mybatis-config-xml-解析">mybatis-config.xml 解析 <a href="#mybatis-config-xml-解析" class="header-anchor">#</a></h4> <p>XMLConfigBuilder 解析 mybatis-config.xml 内容参考代码 :</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/parseConfiguration.png" alt="parseConfiguration"></p> <p><strong>XMLConfifigBuilder#parseConfiguration()</strong> 方法将 mybatis-config.xml 中定义的标签进行相关解析并填充到 Configuration 对象中</p> <h4 id="xxxmapper-xml-解析">xxxMapper.xml 解析 <a href="#xxxmapper-xml-解析" class="header-anchor">#</a></h4> <p><strong>XMLConfifigBuilder#mapperElement()</strong> 中解析配置的 mappers 标签, 找到具体的 .xml 文件, 并将其中的 select、insert、update、delete、resultMap 等标签解析为 Java 中的对象信息</p> <p>具体解析 xxxMapper.xml 的对象为 XMLMapperBuilder, 具体的解析方法为 parse()</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/parse.png" alt="parse"></p> <p>到这里就可以对当前问题作出答复了</p> <p>Mybatis 创建 <strong>SqlSessionFactory</strong> 会解析 <strong>mybatis-config.xml</strong>, 然后 <strong>解析 configuration 标签下的子标签</strong>, 解析 mappers 标签时, 会根据相关配置读取到 .xml 文件, 继而解析 .xml 中各个标签</p> <p>具体的 select、insert、update、delete 标签定义为 <strong>MappedStatement</strong> 对象, .xml 文件中的其余标签也会根据不同映射解析为 Java 对象</p> <h4 id="mappedstatement-2">MappedStatement <a href="#mappedstatement-2" class="header-anchor">#</a></h4> <p>这里重点说明下 MappedStatement 对象, 一起看一下类中的属性和 SQL 有何关联呢</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/MappedStatement.png" alt="MappedStatement"></p> <p>MappedStatement 对象中 <strong>提供的属性与 .xml 文件中定义的 SQL 语句</strong> 是能够对应上的, 用来 <strong>控制每条 SQL 语句的执行行为</strong></p> <h3 id="mapper-接口的存储与实现">Mapper 接口的存储与实现 <a href="#mapper-接口的存储与实现" class="header-anchor">#</a></h3> <p>在平常我们写的 SSM 框架中, 定义了 Mapper 接口与 .xml 对应的 SQL 文件, 在 Service 层直接注入 xxxMapper 就可以了</p> <p>也没有看到像 JDBC 操作数据库的操作, Mybatis 在中间是如何为我们省略下这些重复繁琐的操作呢</p> <p>这里使用 Mybatis 源码中的测试类进行验证, 首先定义 Mapper 接口, 省事直接注解定义 SQL</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/AutoConstructorMapper_new.png" alt="AutoConstructorMapper"></p> <p>这里使用 SqlSession 来获取 Mapper 操作数据库, 测试方法如下</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/primitiveSubjects.png" alt="primitiveSubjects"></p> <h4 id="创建-sqlsession">创建 SqlSession <a href="#创建-sqlsession" class="header-anchor">#</a></h4> <p>#1 从 SqlSessionFactory 中打开一个 新的 SqlSession</p> <h4 id="获取-mapper-实例">获取 Mapper 实例 <a href="#获取-mapper-实例" class="header-anchor">#</a></h4> <p>#2 就存在一个疑问点, 定义的 AutoConstructorMapper 明明是个接口, <strong>为什么可以实例化为对象?</strong></p> <h4 id="动态代理方法调用">动态代理方法调用 <a href="#动态代理方法调用" class="header-anchor">#</a></h4> <p>#3 通过创建的对象调用类中具体的方法, 这里具体聊一下 #2 操作</p> <p>SqlSession 是一个接口, 有一个 <strong>默认的实现类 DefaultSqlSession</strong>, 类中包含了 Configuration 属性</p> <p>Mapper 接口的信息以及 .xml 中 SQL 语句是在 Mybatis <strong>初始化时添加</strong> 到 Configuration 的 <strong>MapperRegistry</strong> 属性中的</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/addMapper.png" alt="MapperRegistry#addMapper"></p> <p>#2 中的 getMapper 就是从 MapperRegistry 中获取 Mapper</p> <p>看一下 MapperRegistry 的类属性都有什么</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/MapperRegistry.png" alt="MapperRegistry"></p> <p>config 为 <strong>保持全局唯一</strong> 的 Configuration 对象引用</p> <p><strong>knownMappers</strong> 中 Key-Class 是 Mapper 对象, Value-MapperProxyFactory 是通过 Mapper 对象衍生出的 <strong>Mapper 代理工厂</strong></p> <p>再看一下 MapperProxyFactory 类的结构信息</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/MapperProxyFactory.png" alt="MapperProxyFactory"></p> <p>mapperInterface 属性是 Mapper 对象的引用, methodCache 的 key 是 Mapper 中的方法, value 是 Mapper 解析对应 SQL 产生的 MapperMethod</p> <blockquote><p>📖 Mybatis 设计 methodCache 属性时使用到了 <strong>懒加载机制</strong>, 在初始化时不会增加对应 Method, 而是在 <strong>第一次调用时新增</strong></p></blockquote> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/cachedMapperMethod.png" alt="cachedMapperMethod"></p> <p>MapperMethod 运行时数据如下, 比较容易理解</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/image-20200902133450941.png" alt="MapperMethod 运行状态"></p> <p>通过一个实际例子帮忙理解一下 MapperRegistry 类关系, Mapper 初始化第一次调用的对象状态, 可以看到 methodCache 容量为 0</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/image-20200821191913092.png" alt="MapperRegistry 运行状态"></p> <p>我们目前已经知道 MapperRegistry 的类关系, 回头继续看一下第二步的 <strong>MapperRegistry#getMapper</strong>() 处理步骤</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/getMapper.png" alt="getMapper"></p> <p>核心处理在 MapperProxyFactory#newInstance() 方法中, 继续跟进</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/newInstance.png" alt="newInstance"></p> <p>MapperProxy <strong>继承了 InvocationHandler 接口</strong>, 通过 newInstance() 最终返回的是由 <strong>Java Proxy 动态代理返回的动态代理实现类</strong></p> <p>看到这里就清楚了步骤二中接口为什么能够被实例化, 返回的是 <strong>接口的动态代理实现类</strong></p> <h3 id="mybatis-sql-的执行过程">Mybatis Sql 的执行过程 <a href="#mybatis-sql-的执行过程" class="header-anchor">#</a></h3> <p>根据 Mybatis SQL 执行流程图进一步了解</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/Mybatis-SQL%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B.png" alt="Mybatis-SQL执行流程"></p> <p>大致可以分为以下几步操作:</p> <blockquote><p>📖 在前面的内容中, 知道了 Mybatis Mapper 是动态代理的实现, 查看 SQL 执行过程, 就需要紧跟实现了 InvocationHandler 的 MapperProxy 类</p></blockquote> <h4 id="执行增删改查">执行增删改查 <a href="#执行增删改查" class="header-anchor">#</a></h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">&quot; SELECT * FROM SUBJECT WHERE ID = #{id}&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">PrimitiveSubject</span> <span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token keyword">final</span> <span class="token keyword">int</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>我们以上述方法举例, 调用方通过 SqlSession 获取 Mapper 动态代理对象, 执行 Mapper 方法时会通过 <strong>InvocationHandler 进行代理</strong></p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/MapperProxy.png" alt="MapperProxy"></p> <p>在 MapperMethod#execute 中, 根据 MapperMethod -&gt; SqlCommand -&gt; <strong>SqlCommandType</strong> 来确定增、删、改、查方法</p> <blockquote><p>📖 SqlCommandType 是一个枚举类型, 对应五种类型 UNKNOWN、INSERT、UPDATE、DELETE、SELECT、FLUSH</p></blockquote> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/execute.png" alt="execute"></p> <h4 id="参数处理">参数处理 <a href="#参数处理" class="header-anchor">#</a></h4> <p>查询操作对应 SELECT 枚举值, if else 中判断为返回值是否集合、无返回值、单条查询等, 这里以查询单条记录作为入口</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Object</span> param <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">convertArgsToSqlCommandParam</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
result <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span>command<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> param<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/convertArgsToSqlCommandParam_new.png" alt="convertArgsToSqlCommandParam_new"></p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/image-20200902124629730.png" alt="参数解析"></p> <blockquote><p>📖 这里能够解释一个之前困扰我的问题, 那就是为什么方法入参只有单个 <code>@Param(&quot;id&quot;)</code>, 但是参数 param 对象会存在两个键值对</p></blockquote> <p>继续查看 <strong>SqlSession#selectOne</strong> 方法, sqlSession 是一个接口, 具体还是要看实现类 <strong>DefaultSqlSession</strong></p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/selectOne.png" alt="selectOne"></p> <p>因为单条和查询多条以及分页查询都是走的一个方法, 所以在查询的过程中, 会将分页的参数进行添加</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/selectList_new.png" alt="selectList"></p> <h4 id="执行器处理">执行器处理 <a href="#执行器处理" class="header-anchor">#</a></h4> <p>在 Mybatis 源码中, 创建的执行器默认是 <strong>CachingExecutor,</strong> 使用了装饰者模式, 在类中保持了 <strong>Executor</strong> 接口的引用, <strong>CachingExecutor</strong> 在持有的执行器基础上增加了缓存的功能</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/CachingExecutor-query-new.png" alt="CachingExecutor#query"></p> <p><strong>delegate.<E>query</E></strong> 就是在具体的执行器了, 默认 <strong>SimpleExecutor,</strong> query 方法统一在抽象父类 <strong>BaseExecutor</strong> 中维护</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/BaseExecutor_query.png" alt="BaseExecutor#query"></p> <p><strong>BaseExecutor#queryFromDatabase</strong> 方法执行了缓存占位符以及执行具体方法, 并将查询返回数据添加至缓存</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/queryFromDatabase.png" alt="queryFromDatabase"></p> <p><strong>BaseExecutor#doQuery</strong> 方法是由具体的 SimpleExecutor 实现</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/doQuery.png" alt="doQuery"></p> <h4 id="执行-sql">执行 SQL <a href="#执行-sql" class="header-anchor">#</a></h4> <p>因为我们 SQL 中使用了参数占位符, 使用的是 <strong>PreparedStatementHandler</strong> 对象 , 执行预编译 SQL 的 Handler, 实际使用 <strong>PreparedStatement</strong> 进行 SQL 调用</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/PreparedStatementHandler_query.png" alt="PreparedStatementHandler_query"></p> <h4 id="返回数据解析">返回数据解析 <a href="#返回数据解析" class="header-anchor">#</a></h4> <p>将 JDBC 返回类型转换为 Java 类型, 根据 resultSets 和 resultMap 进行转换</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/handleResultSets.png" alt="handleResultSets"></p> <h3 id="mybatis-中分页如何实现">Mybatis 中分页如何实现 <a href="#mybatis-中分页如何实现" class="header-anchor">#</a></h3> <p>通过 Mybatis 执行分页 SQL 有两种实现方式, 一种是编写 SQL 时添加 LIMIT, 一种是全局处理</p> <h4 id="sql-分页">SQL 分页 <a href="#sql-分页" class="header-anchor">#</a></h4> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token operator">&lt;</span><span class="token keyword">select</span> id<span class="token operator">=</span><span class="token string">&quot;getSubjectByPage&quot;</span> resultMap<span class="token operator">=</span><span class="token string">&quot;resultAutoMap&quot;</span><span class="token operator">&gt;</span>
    <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> SUBJECT <span class="token keyword">LIMIT</span> <span class="token comment">#{CURRINDEX} , #{PAGESIZE}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">select</span><span class="token operator">&gt;</span>
</code></pre></div><h4 id="拦截器分页">拦截器分页 <a href="#拦截器分页" class="header-anchor">#</a></h4> <p>上文说到, Mybatis 支持了插件扩展机制, 可以拦截到具体对象的方法以及对应入参级别</p> <p>我们添加插件时需要实现 <strong>Interceptor</strong> 接口, 然后将插件写在 mybatis-config.xml 配置文件中或者添加相关注解, Mybatis 初始化时解析才能在项目启动时添加到插件容器中</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/pluginElement.png" alt="pluginElement"></p> <p>由一个 List 结构存储项目中全部拦截器, 通过 <strong>Configuration#addInterceptor</strong> 方法添加</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/InterceptorChain.png" alt="InterceptorChain"></p> <p>重点需要关注 <strong>Interceptor#pluginAll</strong> 中 plugin 方法, Interceptor 只是一个接口, plugin 方法只能由其实现类完成</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/ExamplePlugin.png" alt="ExamplePlugin"></p> <p>Plugin 可以理解为是一个工具类, <strong>Plugin#wrap</strong> 返回的是一个动态代理类 </p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/wrap.png" alt="wrap"></p> <p>这里使用一个测试的 Demo 看一下方法运行时的参数</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/AlwaysMapPlugin.png" alt="AlwaysMapPlugin"></p> <p>虽然是随便写的 Demo, 但是与正式使用的插件并无实际区别</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/image-20200902103355292.png" alt="插件运行状态"></p> <h2 id="相关链接">相关链接 <a href="#相关链接" class="header-anchor">#</a></h2> <p><a href="https://github.com/Mybatis/Mybatis-3" title="源码下载地址" target="_blank" rel="noopener noreferrer">源码下载地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://carbon.now.sh/" target="_blank" rel="noopener noreferrer">代码生成图片<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://www.mdnice.com/" target="_blank" rel="noopener noreferrer">多功能在线 Markdown 编辑器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">9/18/2022, 9:57:31 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/docs/distributed/2pc-3pc.html" class="prev"><i aria-label="icon: left" class="anticon anticon-left"><svg viewBox="64 64 896 896" focusable="false" data-icon="left" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M724 218.3V141c0-6.7-7.7-10.4-12.9-6.3L260.3 486.8a31.86 31.86 0 0 0 0 50.3l450.8 352.1c5.3 4.1 12.9.4 12.9-6.3v-77.3c0-4.9-2.3-9.6-6.1-12.6l-360-281 360-281.1c3.8-3 6.1-7.7 6.1-12.6z"></path></svg></i>
        彻底掌握分布式事务 2PC、3PC 模型
      </a></span> <span class="next"><a href="/docs/frame/mybatis-dynamic-proxy.html">
        心态崩了呀！Mybatis 动态代理这么玩？！
        <i aria-label="icon: right" class="anticon anticon-right"><svg viewBox="64 64 896 896" focusable="false" data-icon="right" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M765.7 486.8L314.9 134.7A7.97 7.97 0 0 0 302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 0 0 0-50.4z"></path></svg></i></a></span></p></div> <!----> </main> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.7eb18571.js" defer></script><script src="/assets/js/2.670b9761.js" defer></script><script src="/assets/js/22.20904317.js" defer></script>
  </body>
</html>